<html>
<head>
    <meta charset="utf-8" />
    <title>Go wasm</title>
</head>

<body>


  <div style="padding: 20px;">
      <ul>
          <li>
              <button onClick="goprint();" disabled id="printBtn">Print Wasm</button>
          </li>
          <li>
              <button onClick="goclose();"  disabled id="closeBtn" >Cancel Wasm</button>
          </li>
      </ul>
  </div>

<script src="wasm_exec.js"></script>

<script>
    if (!WebAssembly.instantiateStreaming) {
        // polyfill
        WebAssembly.instantiateStreaming = async (resp, importObject) => {
            const source = await (await resp).arrayBuffer();
            return await WebAssembly.instantiate(source, importObject);
        };
    }

    const go = new Go();

    let mod, inst;

    WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then(
        async result => {
            mod = result.module;
            inst = result.instance;
            document.getElementById("printBtn").disabled = false;
            document.getElementById("closeBtn").disabled = false;
            await go.run(inst);
            document.getElementById("printBtn").disabled = true;
            document.getElementById("closeBtn").disabled = true;
        }
    );

    // async function run() {
    //     await go.run(inst);
    //     inst = await WebAssembly.instantiate(mod, go.importObject); // reset instance
    // }
</script>


</body>
</html>